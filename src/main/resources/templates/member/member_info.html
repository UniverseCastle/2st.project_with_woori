<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" type="text/css" href="/css/header.css">
<script	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
	<header th:replace="~{header :: header}"></header>
  	<main class="infoMain">
	<h2>회원정보</h2>
		<input type="hidden" id="status" th:value="${detail.member_status}">
		<table class="infoTable">
			<tr class="i_tr1">
				<th class="i_th1">이메일</th>
				<td class="i_td1">
					<span th:text="${detail.member_email}"></span>
				</td>
				<td class="i_td1-1">
					<a th:if="${detail.oauth_id =='none'}" href="/member/auth/chk?url=update">회원 정보 수정 ></a>
					<a th:if="${detail.oauth_id !='none'}" href="/member/auth/update">회원 정보 수정 ></a>
				</td>
			</tr>
			<tr class="i_tr2">
				<th class="i_th2">회원명</th>
				<td class="i_td2">
					<span th:text="${detail.member_name}"></span>
				</td>
			</tr>
			<tr class="i_tr3">
				<th class="i_th3">생일</th>
				<td class="i_td3">
					<span th:text="${#temporals.format(detail.member_birth,'yyyy/MM/dd')}"></span>
				</td>
			</tr>
			<tr class="i_tr4">
				<th class="i_th4">휴대폰번호</th>
				<td class="i_td4">
					<span th:text="${detail.member_phone}"></span>
				</td>
			</tr>
			<tr class="i_tr5">
				<th class="i_th5">성별</th>
				<td class="i_td5">
					<span th:text="${gender}"></span>
				</td>
			</tr>
		</table>
		<div class="userDeleteBtnBox">
			<a th:if="${detail.oauth_id =='none'}" href="/member/auth/chk?url=delete">회원탈퇴</a>
			<button th:if="${detail.oauth_id !='none'}" type="button" class="userDeleteBtn">회원탈퇴</button>
		</div>
	</main>
	<script>
		$(function(){
			$(document).ready(function(){
				const status = $("#status").val();
				if(status === null || status != 'B'){
					alert('권한이없습니다');
		                    window.location.href = '/planner/main';
				}
				
			});
			$(document).on("click",".userDeleteBtn",() => {
		        let csrfToken = $("meta[name='_csrf']").attr("content");
		        let csrfHeader = $("meta[name='_csrf_header']").attr("content");
				if(!confirm('정말 회원탈퇴를 하시겠습니까?')){
					return false;
				}
				$.ajax({
					url : "/member/auth/delete",
					type : "delete",
					beforeSend: function(xhr) {
		                // CSRF 토큰을 요청 헤더에 포함
		                xhr.setRequestHeader(csrfHeader, csrfToken);
		            },
					success : function(){
						location.href="/planner/main";
					},
					error : function(){
						alert("탈퇴실패");
					}
				});
			});
		});
	</script>
</body>
</html>