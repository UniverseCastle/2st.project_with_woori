<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.planner.mapper.FriendMapper">

	<!-- 친구요청 객체 찾기 -->
	<select id="findByFriendRequest" resultType="FriendRequestDTO">
		select *
		from friend_request
		where member_send_id=#{member_send_id}
	</select>
	
	<!-- 친구찾기 리스트 -->
	<select id="findFriend" resultType="FriendDTO">
		
	</select>
	
	<!-- 친구신청 (보낼 때) -->
	<insert id="friendRequest" parameterType="FriendRequestDTO">
		insert into friend_request values(
			friend_request_seq.NEXTVAL,
			#{member_receive_id},
			#{member_send_id},
			'R'
		)
	</insert>
	
	<!-- 친구신청 상태 찾기 -->
	<select id="friendRequestStatus" resultType="String">
		select friend_request_status
		from friend_request
		where member_receive_id = #{member_receive_id}
		and member_send_id = #{member_send_id}
	</select>
	
	<!-- (받은)친구신청 리스트 -->
	<select id="receiveRequestList" resultType="FriendRequestDTO">
		select m.member_id, fr.*
		from member m
		left outer join friend_request fr
		on m.member_id = fr.member_receive_id
		where m.member_id = #{member_receive_id}
		and friend_request_status = 'R'
		and member_status = 'B'
	</select>
	
	<!-- (받은)친구신청 거절 -->
	<delete id="receiveDelete">
		delete
		from friend_request
		where member_receive_id = #{member_receive_id}
		and member_send_id = #{member_send_id}
	</delete>
	
	<!-- 친구수락 -->
	<update id="friendAccept" parameterType="Long">
		update friend_request
		set friend_request_status = 'F'
		where member_receive_id = #{member_receive_id}
		and member_send_id = #{member_send_id}
	</update>
	
	<!-- 친구 테이블에 추가 -->
	<insert id="friendAdd" parameterType="FriendDTO">
		insert into friend values(
			friend_seq.NEXTVAL,
			#{member_my_id},
			#{member_friend_id},
			#{friend_my_nickname},
			#{friend_nickname},
			'none',
			'none',
			'B',
			'B'
		)
	</insert>
	
	<!-- 친구목록 -->
	<select id="friendList" resultType="FriendDTO">
		select *
		from friend
		where member_my_id = #{member_my_id}
		or member_friend_id = #{member_my_id}
	</select>
	
	<!-- 친구 닉네임 변경 -->
	<update id="friendNickName" parameterType="friendDTO">
		update friend
		set
			friend_my_nickname = #{friend_my_nickname},
			friend_nickname = #{friend_nickname}
		where friend_id = #{friend_id}
	</update>
	
	<!-- 친구 메모 변경 -->
	<update id="friendMemo" parameterType="friendDTO">
		update friend
		set
			friend_my_memo = #{friend_my_memo},
			friend_memo = #{friend_memo}
		where friend_id = #{friend_id}
	</update>
	
	<!-- 친구신청 보낸 아이디 찾기 -->
	<!-- 
	<select id="findBySendId" resultType="FriendRequestDTO">
		select *
		from friend_request
		where member_receive_id=#{member_receive_id}
		and member_send_id=#{member_send_id}
	</select>
	-->
	
	<!-- 친구신청 보낸 아이디 찾기 -->
	<!-- 
	<select id="findBySendId" resultType="FriendRequestDTO">
		select member_send_id
		from friend_request
		where member_receive_id=#{member_receive_id}
	</select>
	-->
	
	<!-- 친구신청 보낸 아이디 찾기 -->
	<!--  
	<select id="findBySendId" resultType="FriendRequestDTO">
		select *
		from friend_request
		where member_send_id = #{member_send_id}
		and member_receive_id = #{member_receive_id}
	</select>
	-->
	
	
	<!-- 친구 신청 (받을 때 / 받는사람 데이터 추가) -->
<!-- 	<insert id="friendReceive" parameterType="FriendRequestDTO"> -->
<!-- 		insert into friend_request values( -->
<!-- 			friend_request_seq.NEXTVAL, -->
<!-- 			#{member_receive_id}, -->
<!-- 			#{member_send_id}, -->
<!-- 			'R' -->
<!-- 		) -->
<!-- 	</insert> -->
	
	<!-- 친구신청 상태 -->
	<!--  
	<select id="RequestStatus" resultType="String">
		select friend_request_status
		from friend_request
		where member_receive_id=#{member_receive_id}
		and member_send_id=#{member_send_id}
	</select>
	-->
	
</mapper>